// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User{
  id String @id @default(cuid())
  clerkUserId String @unique
  name String?
  email String @unique
  imageUrl String?
  hasCompletedOnboarding Boolean? @default(false)
  location Location?
  interests String[] @default([])
  freeEventsCreated Int @default(0)
  
  events Event[] 
  registrations Registration[]

  plan UserPlan @default(FREE)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Location{
  id String @id @default(cuid())
  city String
  state String
  country String
  user User @relation(fields: [userId], references: [id])
  userId String @unique
}

model Event{
  id String @id @default(cuid())
  title String
  description String
  slug String @unique

  organizer User @relation(fields: [organizerId], references: [id])
  organizerId String

  category String
  tags String[]

  startDate DateTime
  endDate DateTime
  timezone String

  locationType LocationType @default(OFFLINE)
  venue String?
  address String?
  city String?
  state String?
  country String?

  capacity Int?
  ticketType TicketType
  ticketPrice Float?
  registrationCount Int @default(0)

  coverImageUrl String?
  themeColor String?

  registrations Registration[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([organizerId, category, startDate, slug])
}

model Registration{
  id String @id @default(cuid())
  event Event @relation(fields: [eventId], references: [id])
  eventId String
  user User @relation(fields: [userId], references: [id])
  userId String

  attendeeName String
  attendeeEmail String


  qrCode String
  checkedIn Boolean @default(false)
  checkedInAt DateTime?

  status RegistrationStatus @default(PENDING)
  registeredAt DateTime @default(now())

  @@index([eventId, userId, qrCode])
}

enum UserPlan {
  FREE
  PRO
}

enum LocationType {
  ONLINE
  OFFLINE
  HYBRID
}

enum TicketType {
  FREE
  PAID
}

enum RegistrationStatus {
  PENDING
  CONFIRMED
  CANCELLED
}